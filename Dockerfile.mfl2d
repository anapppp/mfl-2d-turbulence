FROM debian:bookworm-slim

RUN apt-get update && apt-get install -y \
    gfortran \
    libnetcdf-dev \
    libnetcdff-dev \
    && rm -rf /var/lib/apt/lists/*  

WORKDIR /app
COPY mfl2d .

RUN gfortran -O3 -march=native -funroll-loops -fopenmp \
    -I/usr/include \
    mfl2d/src/modules/mod_PontoDePartida.f90 \
    mfl2d/src/modules/mod_RotinasInOut.f90 \
    mfl2d/src/modules/mod_DiferencasFinitas.f90 \
    mfl2d/src/main.f90 \
    -lnetcdff -lnetcdf \
    -o mfl2d

ENV OMP_NUM_THREADS=4
ENV GFORTRAN_UNBUFFERED_ALL=y

CMD ["./mfl2d"]

